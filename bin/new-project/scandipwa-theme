#!/bin/sh

. bin/docker/variables

HOME="/home/node"

echo "Your sudo password is needed to cleanup frontend folder."
cd frontend || ( echo "folder frontend does not exist" && exit )
sudo find . ! -name ".placeholder" -exec rm -rf {} +
cd ..

docker-compose exec php-fpm sh -c "cd $HOME/magento && \
mkdir $HOME/magento/localmodules && \
cd $HOME/magento/localmodules && \
yarn create scandipwa-app scandipwa && \
BUILD_MODE=magento yarn build && \
cd $HOME/magento && \
composer config repo.theme path localmodules/scandipwa && \
composer require scandipwa/scandipwa && \
bin/magento setup:config:set --pq-host=redis --pq-port=6379 --pq-database=5 --ph-scheme=tcp && \
bin/magento setup:upgrade &&
bin/magento cache:disable full_page && \
bin/magento cache:flush"